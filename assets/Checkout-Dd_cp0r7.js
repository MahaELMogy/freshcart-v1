import{r as n,U as p,C as f,u as y,a as g,j as s,H as b,b as h,V as l}from"./index-dGyXJFhP.js";function j(){const[o,a]=n.useState(!1),{UserToken:i}=n.useContext(p),{UserIdCart:d,clearCart:c}=n.useContext(f),u=y();function m(t){a(!0),h.post(`https://ecommerce.routemisr.com/api/v1/orders/${d}`,{shippingAddress:{details:t.details,phone:t.phone,city:t.city}},{headers:{token:i}}).then(r=>{console.log(r.data.status),l.success(r.data.status+"! Your order was completed ."),c(),u("/"),window.scrollTo(0,0)}).catch(r=>{l.error("Something went wrong with your order."),console.error(r)}).finally(()=>{a(!1)})}function x(t){a(!0),h.post(`https://ecommerce.routemisr.com/api/v1/orders/checkout-session/${d}?url=${window.location.origin}`,{shippingAddress:{details:t.details,phone:t.phone,city:t.city}},{headers:{token:i}}).then(r=>{console.log(r),r.data.session&&r.data.session.url?window.location.href=r.data.session.url:(l.success("Order placed successfully!"),c(),u("/"),window.scrollTo(0,0))}).catch(r=>{l.error("Something went wrong with your order."),console.error(r)}).finally(()=>{a(!1)})}const e=g({initialValues:{details:"",phone:"",city:""},validate:t=>{const r={};return t.details||(r.details="Address details are required"),t.phone?/^\d{10,15}$/.test(t.phone)||(r.phone="Please enter a valid phone number"):r.phone="Phone number is required",t.city||(r.city="City is required"),r},onSubmit:x});return n.useEffect(()=>{window.scrollTo(0,0)},[]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"application",children:s.jsx(b,{children:s.jsx("title",{children:"Checkout"})})}),s.jsx("section",{className:"px-4 sm:px-8 md:px-16 lg:px-24 pb-10",children:s.jsxs("div",{className:"w-full max-w-2xl mx-auto mb-10",children:[s.jsx("h3",{className:"my-6 text-2xl font-bold text-green-600 text-center",children:"Place Your Order"}),s.jsxs("form",{onSubmit:e.handleSubmit,className:"flex flex-col gap-4 bg-white border border-gray-200 rounded-lg shadow hover:shadow-md transition p-6",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{htmlFor:"details",className:"text-sm text-gray-700 mb-1",children:"Address Details:"}),s.jsx("input",{type:"text",id:"details",name:"details",onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.details,className:`w-full px-3 py-2 rounded-md border ${e.touched.details&&e.errors.details?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-green-500"} focus:ring-1 focus:outline-none`,placeholder:"Enter your full address"}),e.touched.details&&e.errors.details&&s.jsx("span",{className:"text-red-500 text-xs mt-1",children:e.errors.details})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{htmlFor:"phone",className:"text-sm text-gray-700 mb-1",children:"Phone:"}),s.jsx("input",{type:"tel",id:"phone",name:"phone",onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.phone,className:`w-full px-3 py-2 rounded-md border ${e.touched.phone&&e.errors.phone?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-green-500"} focus:ring-1 focus:outline-none`,placeholder:"Enter your phone number"}),e.touched.phone&&e.errors.phone&&s.jsx("span",{className:"text-red-500 text-xs mt-1",children:e.errors.phone})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{htmlFor:"city",className:"text-sm text-gray-700 mb-1",children:"City:"}),s.jsx("input",{type:"text",id:"city",name:"city",onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.city,className:`w-full px-3 py-2 rounded-md border ${e.touched.city&&e.errors.city?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-green-500"} focus:ring-1 focus:outline-none`,placeholder:"Enter your city"}),e.touched.city&&e.errors.city&&s.jsx("span",{className:"text-red-500 text-xs mt-1",children:e.errors.city})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s.jsx("button",{type:"button",onClick:()=>e.setFieldValue("paymentMethod","cash").then(()=>{e.setSubmitting(!0),m(e.values)}),className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o||!e.isValid||!e.dirty,children:o?s.jsx("i",{className:"fa-solid fa-spinner fa-spin-pulse"}):"Cash on Delivery"}),s.jsx("button",{type:"submit",className:"flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",disabled:o||!e.isValid||!e.dirty,children:o?s.jsx("i",{className:"fa-solid fa-spinner fa-spin-pulse"}):"Pay Online"})]})]})]})})]})}export{j as default};
